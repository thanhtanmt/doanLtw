<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết đơn hàng</title>
</head>
<body>
    <div class="container my-5">
        <div th:if="${order != null}">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Chi tiết đơn hàng #<span th:text="${order.id}">12345</span></h2>
                <a href="/orders" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Quay lại
                </a>
            </div>
            
            <div class="row">
                <!-- Order Info -->
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Thông tin đơn hàng</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <p><strong>Mã đơn hàng:</strong></p>
                                    <p><strong>Ngày đặt:</strong></p>
                                    <p><strong>Trạng thái:</strong></p>
                                    <p><strong>Phương thức thanh toán:</strong></p>
                                </div>
                                <div class="col-6">
                                    <p th:text="'#' + ${order.id}">#12345</p>
                                    <p th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:00</p>
                                    <p>
                                        <span th:class="'badge ' + 
                                              (${order.status == 'PENDING'} ? 'bg-warning' :
                                               ${order.status == 'CONFIRMED'} ? 'bg-info' :
                                               ${order.status == 'SHIPPED'} ? 'bg-primary' :
                                               ${order.status == 'DELIVERED'} ? 'bg-success' : 'bg-danger')"
                                              th:text="${order.status}">
                                            PENDING
                                        </span>
                                    </p>
                                    <p th:text="${order.paymentMethod}">COD</p>
                                </div>
                            </div>
                            
                            <hr>
                            
                            <h6 class="mb-3">Thông tin người nhận</h6>
                            <p class="mb-1"><strong>Họ tên:</strong> <span th:text="${order.customerName}">Nguyễn Văn A</span></p>
                            <p class="mb-1"><strong>Email:</strong> <span th:text="${order.customerEmail}">email@example.com</span></p>
                            <p class="mb-1"><strong>Điện thoại:</strong> <span th:text="${order.customerPhone}">0123456789</span></p>
                            <p class="mb-1"><strong>Địa chỉ:</strong> <span th:text="${order.shippingAddress}">123 Đường ABC, Quận 1, TP.HCM</span></p>
                            
                            <div th:if="${order.notes != null && !order.notes.isEmpty()}">
                                <hr>
                                <h6 class="mb-2">Ghi chú</h6>
                                <p th:text="${order.notes}">Ghi chú của khách hàng</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Items -->
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Sản phẩm đã đặt</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Sản phẩm</th>
                                            <th>Số lượng</th>
                                            <th>Đơn giá</th>
                                            <th>Thành tiền</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="detail : ${order.orderDetails}">
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img th:if="${detail.product.imageUrl != null}" 
                                                         th:src="${detail.product.imageUrl}" 
                                                         class="img-thumbnail me-3" 
                                                         style="width: 60px; height: 60px; object-fit: cover;"
                                                         alt="Product image">
                                                    <div>
                                                        <strong th:text="${detail.product.name}">Áo sơ mi</strong>
                                                    </div>
                                                </div>
                                            </td>
                                            <td th:text="${detail.quantity}">1</td>
                                            <td th:text="${#numbers.formatDecimal(detail.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">500,000 VNĐ</td>
                                            <td class="fw-bold" th:text="${#numbers.formatDecimal(detail.price * detail.quantity, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">500,000 VNĐ</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="col-md-4">
                    <div class="card sticky-top" style="top: 20px;">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Tổng đơn hàng</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Tạm tính:</span>
                                <span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">1,000,000 VNĐ</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Phí vận chuyển:</span>
                                <span class="text-success">Miễn phí</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between">
                                <strong>Tổng cộng:</strong>
                                <strong class="text-danger fs-5" 
                                        th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">
                                    1,000,000 VNĐ
                                </strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 d-grid">
                        <a href="/products" class="btn btn-primary">
                            <i class="fas fa-shopping-bag me-2"></i>Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div th:if="${order == null}" class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Không tìm thấy đơn hàng hoặc bạn không có quyền xem đơn hàng này.
        </div>
    </div>
</body>
</html>
