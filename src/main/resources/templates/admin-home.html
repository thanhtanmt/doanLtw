<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin}">

<head>
    <title>Dashboard</title>
</head>

<body>
    <div layout:fragment="page-title">Dashboard</div>

    <div layout:fragment="content">
        <!-- Welcome Message -->
        <div class="card mb-3">
            <div class="card-body" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 0.75rem;">
                <h2 style="margin-bottom: 0.5rem;">
                    <i class="fas fa-hand-sparkles"></i> Chào mừng trở lại, Admin!
                </h2>
                <p style="margin: 0; opacity: 0.9;">Đây là tổng quan về hệ thống của bạn hôm nay.</p>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon blue">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                </div>
                <div class="stat-body">
                    <h3 th:text="${#numbers.formatDecimal(monthlyRevenue, 0, 'COMMA', 0, 'POINT')} + ' đ'">0 đ</h3>
                    <p class="stat-label">Doanh thu tháng này</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon green">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                </div>
                <div class="stat-body">
                    <h3 th:text="${newOrders}">0</h3>
                    <p class="stat-label">Đơn hàng mới</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon orange">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="stat-body">
                    <h3 th:text="${totalUsers}">0</h3>
                    <p class="stat-label">Người dùng</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon purple">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div class="stat-body">
                    <h3 th:text="${totalOrders}">0</h3>
                    <p class="stat-label">Tổng đơn hàng</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-bolt"></i> Thao tác nhanh
                </h2>
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <a th:href="@{/admin/users}" class="btn btn-outline" style="text-decoration: none;">
                        <i class="fas fa-users-cog"></i> Quản lý người dùng
                    </a>
                    <a th:href="@{/admin/shops}" class="btn btn-outline" style="text-decoration: none;">
                        <i class="fas fa-store"></i> Quản lý Shop
                    </a>
                    <a th:href="@{/admin/shippers}" class="btn btn-outline" style="text-decoration: none;">
                        <i class="fas fa-shipping-fast"></i> Quản lý Shipper
                    </a>
                    <a th:href="@{/admin/vouchers}" class="btn btn-outline" style="text-decoration: none;">
                        <i class="fas fa-ticket-alt"></i> Tạo Voucher
                    </a>
                    <a th:href="@{/admin/products}" class="btn btn-outline" style="text-decoration: none;">
                        <i class="fas fa-box-open"></i> Quản lý sản phẩm
                    </a>
                    <a th:href="@{/admin/transactions}" class="btn btn-outline" style="text-decoration: none;">
                        <i class="fas fa-file-invoice-dollar"></i> Xem đơn hàng
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
            <!-- Recent Orders -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-shopping-bag"></i> Đơn hàng gần đây
                    </h3>
                    <a th:href="@{/admin/transactions}" class="btn btn-sm btn-outline">Xem tất cả</a>
                </div>
                <div class="card-body">
                    <div th:if="${recentOrders != null and !recentOrders.isEmpty()}" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div th:each="order : ${recentOrders}" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--content-bg); border-radius: 0.5rem;">
                            <div>
                                <strong th:text="'#' + ${order.orderCode}">#ORD12345</strong>
                                <br>
                                <small style="color: var(--text-secondary);" th:text="${order.user != null ? (order.user.firstName + ' ' + order.user.lastName) : 'Khách hàng'}">Khách hàng</small>
                            </div>
                            <div style="text-align: right;">
                                <strong style="color: var(--success-color);" th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' đ'">0 đ</strong>
                                <br>
                                <span class="status-badge" 
                                      th:classappend="${order.status.name() == 'PENDING' ? 'pending' : 
                                                       order.status.name() == 'CONFIRMED' ? 'active' : 
                                                       order.status.name() == 'ASSIGNED' ? 'active' : 
                                                       order.status.name() == 'DELIVERING' ? 'completed' : 
                                                       order.status.name() == 'DELIVERED' ? 'active' : 
                                                       order.status.name() == 'FAILED' ? 'inactive' : 'inactive'}"
                                      th:text="${order.status.name() == 'PENDING' ? 'Chờ xác nhận' : 
                                               order.status.name() == 'CONFIRMED' ? 'Đã xác nhận' : 
                                               order.status.name() == 'ASSIGNED' ? 'Đã giao shipper' : 
                                               order.status.name() == 'DELIVERING' ? 'Đang giao' : 
                                               order.status.name() == 'DELIVERED' ? 'Đã giao' : 
                                               order.status.name() == 'CANCELED' ? 'Đã hủy' : 'Thất bại'}">
                                    Chờ xử lý
                                </span>
                            </div>
                        </div>
                    </div>
                    <div th:if="${recentOrders == null or recentOrders.isEmpty()}" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-inbox" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p>Chưa có đơn hàng nào</p>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-pie"></i> Trạng thái hệ thống
                    </h3>
                </div>
                <div class="card-body">
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Shipper hoạt động</span>
                                <strong th:text="${shipperActiveRate} + '%'">0%</strong>
                            </div>
                            <div style="height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                                <div th:style="'width: ' + ${shipperActiveRate} + '%; height: 100%; background: var(--success-color);'"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Shop đang hoạt động</span>
                                <strong th:text="${sellerActiveRate} + '%'">0%</strong>
                            </div>
                            <div style="height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                                <div th:style="'width: ' + ${sellerActiveRate} + '%; height: 100%; background: var(--info-color);'"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Người dùng hoạt động</span>
                                <strong th:text="${totalUsers > 0 ? #numbers.formatDecimal((activeUsers * 100.0 / totalUsers), 0, 0) : 0} + '%'">0%</strong>
                            </div>
                            <div style="height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                                <div th:style="'width: ' + (${totalUsers > 0 ? (activeUsers * 100.0 / totalUsers) : 0}) + '%; height: 100%; background: var(--warning-color);'"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Đơn hàng thành công</span>
                                <strong th:text="${successRate} + '%'">0%</strong>
                            </div>
                            <div style="height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
                                <div th:style="'width: ' + ${successRate} + '%; height: 100%; background: var(--success-color);'"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>