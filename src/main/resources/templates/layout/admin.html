<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fashion store</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" th:href="@{/css/admin-modern.css}">

</head>

<body>
	<div class="admin-wrapper">
		<!-- Sidebar -->
		<aside class="sidebar">
			<div class="sidebar-header">
				<a th:href="@{/admin}" class="sidebar-logo">
					<i class="fas fa-shield-alt"></i>
					<span>ADMIN PANEL</span>
				</a>
			</div>

			<nav class="sidebar-nav">
				<!-- Main Section -->
				<div class="nav-section">
					<div class="nav-section-title">MAIN</div>
					<a th:href="@{/admin/dashboard}" class="nav-item">
						<i class="fas fa-tachometer-alt"></i>
						<span>Dashboard</span>
					</a>
				</div>

				<!-- Management Section -->
				<div class="nav-section">
					<div class="nav-section-title">QUẢN LÝ</div>
					<a th:href="@{/admin/users}" class="nav-item">
						<i class="fas fa-users-cog"></i>
						<span>Người dùng</span>
					</a>
					<a th:href="@{/admin/shops}" class="nav-item">
						<i class="fas fa-store"></i>
						<span>Shop & Doanh thu</span>
					</a>
					<a th:href="@{/admin/shippers}" class="nav-item">
						<i class="fas fa-shipping-fast"></i>
						<span>Shipper</span>
					</a>
					<a th:href="@{/admin/products}" class="nav-item">
						<i class="fas fa-box-open"></i>
						<span>Sản phẩm</span>
					</a>
					<a th:href="@{/admin/transactions}" class="nav-item">
						<i class="fas fa-file-invoice-dollar"></i>
						<span>Đơn hàng</span>
					</a>
				</div>

				<!-- Promotions Section -->
				<div class="nav-section">
					<div class="nav-section-title">KHUYẾN MÃI</div>
					<a th:href="@{/admin/vouchers}" class="nav-item">
						<i class="fas fa-ticket-alt"></i>
						<span>Voucher</span>
					</a>
				</div>

				<!-- Settings Section -->
				<div class="nav-section">
					<div class="nav-section-title">CÀI ĐẶT</div>
					<a th:href="@{/admin/profile}" class="nav-item">
						<i class="fas fa-user-circle"></i>
						<span>Hồ sơ</span>
					</a>
				</div>
			</nav>
		</aside>

		<!-- Main Content -->
		<div class="main-content">
			<!-- Top Bar -->
			<div class="topbar">
				<div class="topbar-left">
					<h1 layout:fragment="page-title">Dashboard</h1>
				</div>
				<div class="topbar-right">
					<a th:href="@{/}" target="_blank" class="topbar-icon" title="Xem Shop">
						<i class="fas fa-store"></i>
					</a>
					
					<div class="user-profile" sec:authorize="isAuthenticated()">
						<img th:src="${currentUser?.avatarUrl != null and currentUser?.avatarUrl != '' ? currentUser.avatarUrl : 'https://via.placeholder.com/40'}" 
						     alt="Avatar" 
						     class="user-avatar"
						     onerror="this.src='https://via.placeholder.com/40'">
						<div class="user-info">
							<div class="user-name" th:text="${currentUser != null ? (currentUser.firstName + ' ' + currentUser.lastName) : 'Admin'}">Admin</div>
							<div class="user-role">
								<span th:if="${currentUser == null}">Administrator</span>
								<span th:if="${currentUser != null and currentUser.roles != null}" th:each="role,iter : ${currentUser.roles}">
									<span th:text="${role.name == 'ROLE_ADMIN' ? 'Administrator' : (role.name == 'ROLE_SELLER' ? 'Seller' : 'Shipper')}">ROLE</span><span th:if="${!iter.last}">, </span>
								</span>
							</div>
						</div>
						<div class="dropdown-menu">
							<a th:href="@{/admin/profile}">
								<i class="fas fa-user-circle"></i> Hồ sơ
							</a>
							<form th:action="@{/logout}" method="post" th:if="${_csrf != null}" style="margin: 0;">
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
								<button type="submit">
									<i class="fas fa-sign-out-alt"></i> Đăng xuất
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>

			<!-- Content Area -->
			<div class="content">
				<main layout:fragment="content"></main>
			</div>
		</div>
	</div>

	<script>
		// Active menu item based on current URL
		document.addEventListener('DOMContentLoaded', function() {
			const currentPath = window.location.pathname;
			const navLinks = document.querySelectorAll('.nav-item');
			
			navLinks.forEach(link => {
				const href = link.getAttribute('href');
				if (href === currentPath || 
				    (href !== '/admin/dashboard' && currentPath.startsWith(href)) ||
				    (href === '/admin/dashboard' && (currentPath === '/admin' || currentPath === '/admin/' || currentPath === '/admin/dashboard'))) {
					link.classList.add('active');
				}
			});
			
			// User dropdown toggle
			const userProfile = document.querySelector('.user-profile');
			const dropdownMenu = document.querySelector('.dropdown-menu');
			
			if (userProfile && dropdownMenu) {
				userProfile.addEventListener('click', function(e) {
					e.stopPropagation();
					dropdownMenu.classList.toggle('show');
				});
				
				document.addEventListener('click', function() {
					dropdownMenu.classList.remove('show');
				});
			}
		});
	</script>
	
	<!-- Page-specific scripts -->
	<th:block layout:fragment="scripts"></th:block>
</body>
</html>