
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title layout:title-pattern="$DECORATOR_TITLE - Admin Panel">Admin
	Panel</title>

<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
	rel="stylesheet">

<link rel="stylesheet" th:href="@{/css/modern.css}">

</head>

<body>
	<header>
		<div class="header-container">
			<a th:href="@{/admin}" class="logo"> <i class="fas fa-shield-alt"></i>
				ADMIN PANEL
			</a>
			<div class="header-actions">
				<a th:href="@{/}" target="_blank" title="Xem Shop"> <i
					class="fas fa-store"></i>
				</a> <a href="#" title="Thông báo"> <i class="fas fa-bell"></i>
				</a>

				<div class="user-menu" sec:authorize="isAuthenticated()">
					<div class="user-menu-toggle">
						<i class="fas fa-user-circle"></i> <span sec:authentication="name">Admin</span>
					</div>
					<div class="user-dropdown">
						<a th:href="@{/admin/profile}"><i class="fas fa-user-circle"></i>
							Hồ sơ</a> <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i>
							Đăng xuất</a>
					</div>
				</div>
			</div>
		</div>

	</header>

	<nav>
		<div class="nav-container">
			<a th:href="@{/admin}"> <i class="fas fa-tachometer-alt"></i>
				Dashboard
			</a> <a th:href="@{/admin/transactions}"> <i
				class="fas fa-file-invoice-dollar"></i> Đơn hàng
			</a> <a th:href="@{/admin/products}"> <i class="fas fa-box-open"></i>
				Sản phẩm
			</a> <a th:href="@{/admin/customers}"> <i class="fas fa-users"></i>
				Khách hàng
			</a>
		</div>

	</nav>

	<main layout:fragment="content"></main>

	<footer>
		<p>© 2025 Fashion Store Admin Panel. All rights reserved.</p>
	</footer>
	
	<div id="logoutModal" class="modal-overlay" style="display: none;">
		<div class="modal-box scale-in">
			<div class="modal-header">
				<h3>Xác nhận Đăng xuất</h3>
				<button id="closeModalBtn" class="modal-close-btn">&times;</button>
			</div>
			<div class="modal-body">
				<p>Bạn có chắc chắn muốn đăng xuất không?</p>
			</div>
			<div class="modal-footer">
				<button id="cancelLogoutBtn" class="btn btn-secondary">Hủy
					bỏ</button>
				<a id="confirmLogoutBtn" href="#" class="btn btn-danger">Đăng
					xuất</a>
			</div>
		</div>
	</div>
	
	<script>
	        // Script này tự động thêm class 'active' cho link nav
	        // dựa trên URL của trang hiện tại.
	        document.addEventListener('DOMContentLoaded', function() {
	            const currentPath = window.location.pathname;
	            const navLinks = document.querySelectorAll('.nav-container a');
	
	            let isHome = true;
	            navLinks.forEach(link => {
	                const linkPath = link.getAttribute('href');
	                // Kiểm tra chính xác hoặc bắt đầu bằng (cho các trang con)
	                if (currentPath.startsWith(linkPath) && linkPath !== '/admin') {
	                    link.classList.add('active');
	                    isHome = false;
	                }
	            });
	            
	            // Xử lý riêng cho trang chủ admin
	            if (isHome || currentPath === '/admin' || currentPath === '/admin/') {
	                 const homeLink = document.querySelector('.nav-container a[href="/admin"]');
	                 if(homeLink) {
	                    homeLink.classList.add('active');
	                 }
	            }
	         // === REPLACE OLD LOGOUT CODE WITH THIS ===
	            const logoutLink = document.querySelector('.user-dropdown a[href*="logout"]');
	            const logoutModal = document.getElementById('logoutModal');
	            const closeModalBtn = document.getElementById('closeModalBtn');
	            const cancelLogoutBtn = document.getElementById('cancelLogoutBtn');
	            const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');

	            // Function to show the modal
	            function showLogoutModal(event) {
	                event.preventDefault(); // Prevent link navigation
	                if (logoutModal) {
	                    // Set the correct href on the confirm button *before* showing
	                    if (confirmLogoutBtn) {
	                        confirmLogoutBtn.href = this.href; // 'this' refers to the clicked logoutLink
	                    }
	                    logoutModal.style.display = 'flex'; // Use flex to center
	                    // Force a reflow before adding the class to make transition work
	                    logoutModal.offsetHeight; 
	                    logoutModal.classList.add('show');
	                }
	            }

	            // Function to hide the modal
	            function hideLogoutModal() {
	                if (logoutModal) {
	                    logoutModal.classList.remove('show');
	                    // Optional: Reset href after hiding if needed, though not strictly necessary
	                    // if (confirmLogoutBtn) { confirmLogoutBtn.href = "#"; }

	                    // Wait for transition to finish before setting display none
	                     setTimeout(() => {
	                        if (!logoutModal.classList.contains('show')) { // Check again in case user quickly reopened
	                            logoutModal.style.display = 'none';
	                        }
	                    }, 300); // Match transition duration (0.3s)
	                }
	            }

	            // Add event listeners
	            if (logoutLink) {
	                logoutLink.addEventListener('click', showLogoutModal);
	            }
	            if (closeModalBtn) {
	                closeModalBtn.addEventListener('click', hideLogoutModal);
	            }
	            if (cancelLogoutBtn) {
	                cancelLogoutBtn.addEventListener('click', hideLogoutModal);
	            }

	            // Also hide if user clicks outside the modal box
	            if (logoutModal) {
	                logoutModal.addEventListener('click', function(event) {
	                    // Check if the click was directly on the overlay, not the box inside
	                    if (event.target === logoutModal) {
	                        hideLogoutModal();
	                    }
	                });
	            }
	            // NOTE: The confirmLogoutBtn doesn't need a JS listener,
	            // it's just a normal link now, its href gets set before showing.
	            // === END REPLACEMENT ===
	        });
	    </script>
</body>
</html>